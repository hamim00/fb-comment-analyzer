<div class="page-shell ana-root">
  <div class="hero"><div class="hero__inner"><h1 class="hero-title">Content Planner</h1></div></div>

  <div class="row g-4">
    <div class="col-12 col-xl-5">
      <div class="card p-3">
        <h6 class="mb-2">New Draft</h6>
        <form method="post" action="{{ url_for('planner_new', post_id=post_id) }}">
          <div class="row g-2">
            <div class="col-6">
              <label class="form-label small">Platform</label>
              <select name="platform" class="form-select">
                <option>Facebook</option>
                <option>Instagram</option>
              </select>
            </div>
            <div class="col-6">
              <label class="form-label small">Target (Page/User)</label>
              <input name="target" class="form-control" placeholder="Page name or @handle">
            </div>
            <div class="col-12">
              <label class="form-label small">Caption</label>
              <textarea name="caption" class="form-control" rows="3" placeholder="Write your caption..."></textarea>
            </div>
            <div class="col-12">
              <label class="form-label small">Hashtags</label>
              <input name="hashtags" class="form-control" placeholder="#brand #promo">
            </div>
            <div class="col-12">
              <label class="form-label small">Media URL (optional)</label>
              <input name="media_url" class="form-control" placeholder="https://...">
            </div>
            <div class="col-12">
              <label class="form-label small">Schedule (UTC)</label>
              <input name="scheduled_at" type="datetime-local" class="form-control">
            </div>
          </div>
          <div class="mt-3 d-flex gap-2">
            <button class="btn btn-primary">Save Draft</button>
          </div>
        </form>
      </div>
    </div>

    <div class="col-12 col-xl-7">
      <div class="card p-3">
        <h6 class="mb-2">Drafts</h6>
        <div class="table-responsive">
          <table class="table table-sm align-middle">
            <thead>
              <tr>
                <th>ID</th><th>Platform</th><th>Target</th><th>Caption</th><th>When</th><th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for d in extras.drafts %}
                <tr>
                  <td>{{ d.id }}</td>
                  <td>{{ d.platform }}</td>
                  <td>{{ d.target }}</td>
                  <td class="clamp clamp-1">{{ d.caption }}</td>
                  <td>{{ d.scheduled_at or '-' }}</td>
                  <td class="d-flex gap-2">
                    <!-- âœ… Safe: pass string to JS using tojson -->
                    <button
                      class="btn btn-sm btn-outline-secondary"
                      onclick="copyCap({{ d.caption|default('')|tojson }})">
                      Copy Caption
                    </button>

                    <a class="btn btn-sm btn-primary" target="_blank" href="{{ url_for('planner_open', pid=d.id) }}">
                      Open Composer
                    </a>

                    <form method="post" action="{{ url_for('planner_delete', pid=d.id) }}" onsubmit="return confirm('Delete draft?')">
                      <button class="btn btn-sm btn-outline-danger">Delete</button>
                    </form>
                  </td>
                </tr>
              {% else %}
                <tr><td colspan="6" class="text-muted-compact">No drafts yet.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <div class="text-muted-compact">Assist Mode: We open the composer and copy your caption. Full auto-post needs Meta App Review.</div>
      </div>
    </div>
  </div>
</div>

<script>
function copyCap(txt){
  navigator.clipboard.writeText(txt || '')
    .then(()=>alert('Caption copied to clipboard.'))
    .catch(()=>alert('Could not access clipboard; please copy manually.'));
}
</script>
